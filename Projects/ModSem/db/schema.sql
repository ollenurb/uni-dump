DROP DATABASE IF EXISTS plant_pathology;
CREATE DATABASE plant_pathology;
\c plant_pathology;

CREATE TABLE plants (
    eppo_code VARCHAR PRIMARY KEY,
    name VARCHAR,
    phylum_eppo_code VARCHAR,
    phylum_name VARCHAR,
    family_eppo_code VARCHAR,
    family_name VARCHAR
);

CREATE TABLE plants_names (
    id SERIAL PRIMARY KEY,
    plant VARCHAR,
    name VARCHAR,
    language VARCHAR,
    FOREIGN KEY (plant) REFERENCES plants(eppo_code)
);

CREATE TABLE pathogens (
    eppo_code VARCHAR PRIMARY KEY,
    name VARCHAR
);

CREATE TABLE subterritories (
    iso_3166_2_it VARCHAR PRIMARY KEY,
    italian_name VARCHAR,
    english_name VARCHAR
);

CREATE TABLE presences (
    id SERIAL PRIMARY KEY,
    year SMALLINT,
    pathogen VARCHAR,
    subterritory VARCHAR,
    eradicated BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (pathogen) REFERENCES pathogens(eppo_code),
    FOREIGN KEY (subterritory) REFERENCES subterritories(iso_3166_2_it)
);

CREATE TABLE pathogens_hosts (
    id SERIAL PRIMARY KEY,
    pathogen VARCHAR,
    plant VARCHAR,
    host_type CHAR,
    FOREIGN KEY (plant) REFERENCES plants(eppo_code),
    FOREIGN KEY (pathogen) REFERENCES pathogens(eppo_code)
);

-- Families of host plants which are handled differently in the ontology
CREATE TABLE special_families (
    eppo_code VARCHAR PRIMARY KEY
);

INSERT INTO pathogens (eppo_code, name) VALUES
    ('XANTFR', 'Xanthomonas fragariae'),
    ('XANTAV', 'Xanthomonas axonopodis pv. vesicatoria'), -- Incorrect naming
    ('METFPR', 'Metcalfa pruinosa'),
    ('PLASHA', 'Plasmopara halstedii'),
    ('COLLAC', 'Colletotrichum acutatum'),
    ('SCLECA', 'Ciborinia camelliae'),
    ('CORBMI', 'Clavibacter michiganensis subsp. michiganensis'),
    ('XANTPR', 'Xanthomonas arboricola pv. pruni'),
    ('DPHNPE', 'Cydalima perspectalis'),
    ('LISSOR', 'Lissorhoptrus oryzophilus'),
    ('DIABVI', 'Diabrotica virgifera virgifera'),
    ('PYRIOR', 'Pyricularia oryzae'),
    ('ENDOPA', 'Cryphonectria parasitica'),
    ('ERYSCY', 'Erysiphe corylacearum'),
    ('ERWIAM', 'Erwinia amylovora'),
    ('XYLEFA', 'Xylella fastidiosa'),
    ('CERAFP', 'Ceratocystis platani'),
    ('GEOHMO', 'Geosmithia morbida'),
    ('ALECSN', 'Aleurocanthus spiniferus'),
    ('AROMBU', 'Aromia bungii'),
    ('DACUDO', 'Bactrocera dorsalis'), -- Transient
    ('POPIJA', 'Popillia japonica'),
    ('ANOLCN', 'Anoplophora chinensis'),
    ('ANOLGL', 'Anoplophora glabripennis'),
    ('IPSXTY', 'Ips typographus'),
    ('PSACHI', 'Psacothea hilaris'),
    ('XYLOCH', 'Xylotrechus chinensis'),
    ('HYPHCU', 'Hyphantria cunea'),
    ('THAUPI', 'Thaumetopoea pityocampa'),
    ('THAUPR', 'Thaumetopoea processionea'),
    ('MELGGC', 'Meloidogyne graminicola'),
    ('PHYP64', 'Grapevine flavescence dor√©e phytoplasma');

INSERT INTO subterritories (iso_3166_2_it, italian_name, english_name) VALUES
    ('IT-65', 'Abruzzo', 'Abruzzo'),
    ('IT-77', 'Basilicata', 'Basilicata'),
    ('IT-78', 'Calabria', 'Calabria'),
    ('IT-72', 'Campania', 'Campania'),
    ('IT-45', 'Emilia-Romagna', 'Emilia-Romagna'),
    ('IT-36', 'Friuli-Venezia-Giulia', 'Friuli-Venezia-Giulia'),
    ('IT-62', 'Lazio', 'Lazio'),
    ('IT-42', 'Liguria', 'Liguria'),
    ('IT-25', 'Lombardia', 'Lombardy'),
    ('IT-57', 'Marche', 'Marche'),
    ('IT-67', 'Molise', 'Molise'),
    ('IT-21', 'Piemonte', 'Piedmont'),
    ('IT-75', 'Puglia', 'Apulia'),
    ('IT-88', 'Sardegna', 'Sardinia'),
    ('IT-82', 'Sicilia', 'Sicily'),
    ('IT-32', 'Toscana', 'Tuscany'),
    ('IT-52', 'Trentino-Alto-Adige', 'Trentino-Alto-Adige'),
    ('IT-55', 'Umbria', 'Umbria'),
    ('IT-23', 'Valle di Aosta', 'Aosta Valley'),
    ('IT-34', 'Veneto', 'Veneto');

INSERT INTO presences (pathogen, subterritory, year) VALUES
    ('XANTFR', 'IT-82', 1972),
    ('XANTFR', 'IT-77', 1977),
    ('XANTFR', 'IT-62', 1994),
    ('XANTFR', 'IT-72', 1994),
    ('XANTFR', 'IT-45', 1994),
    ('XANTFR', 'IT-21', null),
    ('XANTAV', 'IT-25', 1999),
    ('XANTAV', 'IT-55', 1999),
    ('XANTAV', 'IT-88', 1999),
    ('XANTAV', 'IT-21', null),
    ('METFPR', 'IT-34', 1979),
    ('METFPR', 'IT-45', 1984),
    ('METFPR', 'IT-36', 1985),
    ('METFPR', 'IT-21', 1990),
    ('METFPR', 'IT-32', 1991),
    ('METFPR', 'IT-82', 1997),
    ('METFPR', 'IT-88', 1999),
    ('METFPR', 'IT-42', 2002),
    ('METFPR', 'IT-65', 2004),
    ('METFPR', 'IT-72', 2004),
    ('METFPR', 'IT-52', 2005),
    ('METFPR', 'IT-77', 2006),
    ('PLASHA', 'IT-36', 1949),
    ('PLASHA', 'IT-21', null),
    ('COLLAC', 'IT-52', 1986),
    ('COLLAC', 'IT-25', 1998),
    ('COLLAC', 'IT-62', 2005),
    ('COLLAC', 'IT-78', 2006),
    ('COLLAC', 'IT-21', null),
    ('SCLECA', 'IT-21', 2001),
    ('SCLECA', 'IT-32', 2001),
    ('SCLECA', 'IT-62', 2001),
    ('SCLECA', 'IT-25', null),
    ('SCLECA', 'IT-72', null),
    ('SCLECA', 'IT-42', null),
    ('CORBMI', 'IT-75', null),
    ('CORBMI', 'IT-77', null),
    ('CORBMI', 'IT-62', 1997),
    ('CORBMI', 'IT-25', 1998),
    ('CORBMI', 'IT-36', 2010),
    ('CORBMI', 'IT-88', 2010),
    ('CORBMI', 'IT-21', null),
    ('XANTPR', 'IT-45', null),
    ('XANTPR', 'IT-34', null),
    ('XANTPR', 'IT-36', null),
    ('XANTPR', 'IT-65', 1998),
    ('XANTPR', 'IT-62', 1998),
    ('XANTPR', 'IT-77', 2002),
    ('XANTPR', 'IT-32', 2010),
    ('XANTPR', 'IT-21', null),
    ('XANTPR', 'IT-88', null),
    ('XANTPR', 'IT-82', null),
    ('DPHNPE', 'IT-25', 2011),
    ('DPHNPE', 'IT-21', 2012),
    ('LISSOR', 'IT-25', 2004),
    ('LISSOR', 'IT-21', 2004),
    ('LISSOR', 'IT-45', 2013),
    ('LISSOR', 'IT-34', 2014),
    ('DIABVI', 'IT-34', 1998),
    ('DIABVI', 'IT-25', 2000),
    ('DIABVI', 'IT-21', 2001),
    ('DIABVI', 'IT-36', 2002),
    ('DIABVI', 'IT-45', 2003),
    ('DIABVI', 'IT-52', 2003),
    ('DIABVI', 'IT-32', 2010),
    ('DIABVI', 'IT-55', 2013),
    ('PYRIOR', 'IT-21', 2001),
    ('PYRIOR', 'IT-25', null),
    ('ENDOPA', 'IT-42', 1938),
    ('ENDOPA', 'IT-21', null),
    ('ENDOPA', 'IT-88', 2010),
    ('ENDOPA', 'IT-82', null),
    ('ENDOPA', 'IT-25', null),
    ('ERYSCY', 'IT-21', 2020),
    ('ERWIAM', 'IT-75', 1990),
    ('ERWIAM', 'IT-82', 1991),
    ('ERWIAM', 'IT-45', 1995),
    ('ERWIAM', 'IT-25', 1997),
    ('ERWIAM', 'IT-34', 1997),
    ('ERWIAM', 'IT-52', 1999),
    ('ERWIAM', 'IT-72', 2000),
    ('ERWIAM', 'IT-21', 2003),
    ('ERWIAM', 'IT-32', 2020),
    ('CERAFP', 'IT-32', 1971),
    ('CERAFP', 'IT-72', 1973),
    ('CERAFP', 'IT-34', 1975),
    ('CERAFP', 'IT-25', 1979),
    ('CERAFP', 'IT-62', 1992),
    ('CERAFP', 'IT-82', 1992),
    ('CERAFP', 'IT-45', null),
    ('CERAFP', 'IT-36', null),
    ('GEOHMO', 'IT-34', 2013),
    ('GEOHMO', 'IT-21', 2016),
    ('GEOHMO', 'IT-36', 2016),
    ('ALECSN', 'IT-75', 2008),
    ('ALECSN', 'IT-72', 2017),
    ('ALECSN', 'IT-62', 2017),
    ('ALECSN', 'IT-77', 2018),
    ('ALECSN', 'IT-45', 2018),
    ('ALECSN', 'IT-82', 2021),
    ('ALECSN', 'IT-32', 2022),
    ('ALECSN', 'IT-42', 2022),
    ('ALECSN', 'IT-78', 2022),
    ('ALECSN', 'IT-25', 2022),
    ('AROMBU', 'IT-72', 2012),
    ('AROMBU', 'IT-25', 2013),
    ('AROMBU', 'IT-62', 2019),
    ('DACUDO', 'IT-72', 2018),
    ('DACUDO', 'IT-45', 2022),
    ('DACUDO', 'IT-45', 2022),
    ('POPIJA', 'IT-21', 2014),
    ('POPIJA', 'IT-25', 2014),
    ('POPIJA', 'IT-45', 2022),
    ('POPIJA', 'IT-23', 2022),
    ('ANOLCN', 'IT-25', 2000),
    ('ANOLCN', 'IT-62', 2008),
    ('ANOLCN', 'IT-32', 2014),
    ('ANOLGL', 'IT-25', 2007),
    ('ANOLGL', 'IT-34', 2009),
    ('ANOLGL', 'IT-57', 2013),
    ('ANOLGL', 'IT-21', 2018),
    ('IPSXTY', 'IT-25', null),
    ('IPSXTY', 'IT-32', null),
    ('IPSXTY', 'IT-78', null),
    ('IPSXTY', 'IT-52', null),
    ('PSACHI', 'IT-25', 2005),
    ('XYLOCH', 'IT-25', 2023),
    ('HYPHCU', 'IT-45', 1980),
    ('HYPHCU', 'IT-25', null),
    ('THAUPI', 'IT-25', null),
    ('THAUPI', 'IT-45', null),
    ('THAUPI', 'IT-82', null),
    ('THAUPI', 'IT-88', 2006),
    ('THAUPR', 'IT-25', null),
    ('MELGGC', 'IT-21', 2016),
    ('MELGGC', 'IT-25', 2018),
    ('PHYP64', 'IT-36', 1994),
    ('PHYP64', 'IT-42', 1995),
    ('PHYP64', 'IT-34', 1997),
    ('PHYP64', 'IT-21', 2000),
    ('PHYP64', 'IT-25', 2000),
    ('PHYP64', 'IT-57', 2011),
    ('XYLEFA', 'IT-75', 2013),
    ('XYLEFA', 'IT-32', 2018),
    ('XYLEFA', 'IT-62', 2019);

INSERT INTO presences (pathogen, subterritory, year, eradicated) VALUES
    ('IPSXTY', 'IT-88', null, TRUE),
    ('GEOHMO', 'IT-25', 2016, TRUE),
    ('GEOHMO', 'IT-45', 2019, TRUE);

-- Empirically derived list (by computed frequencies)
INSERT INTO special_families (eppo_code) VALUES
    ('1ROSF'),
    ('1PINF'),
    ('1FAGF'),
    ('1GRAF'),
    ('1SAPF'),
    ('1SALF'),
    ('1SOLF'),
    ('1ANAF'),
    ('1MYTF'),
    ('1JUGF'),
    ('1LEGF'),
    ('1BETF'),
    ('1CRLF'),
    ('1MORF'),
    ('1RUTF'),
    ('1COMF'),
    ('1THEF'),
    ('1BUXF'),
    ('1VITF'),
    ('1AMYF'),
    ('1PLTF');
